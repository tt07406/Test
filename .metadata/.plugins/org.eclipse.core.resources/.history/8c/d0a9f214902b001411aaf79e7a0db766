package com.action;



import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;

import javax.servlet.ServletException;

import org.apache.commons.io.FileUtils;
import org.apache.struts2.ServletActionContext;


import com.model.Picture;
import com.opensymphony.xwork2.ActionSupport;

public class PictureAction extends ActionSupport {

	/**
	 * 
	 */
	private static final long serialVersionUID = 1L;
	
	private File file;
	
    private String fileFileName;
    
    private String fileContentType;
    
    
	
	public File getFile() {
		return file;
	}



	public void setFile(File file) {
		this.file = file;
	}



	public String getFileFileName() {
		return fileFileName;
	}



	public void setFileFileName(String fileFileName) {
		this.fileFileName = fileFileName;
	}



	public String getFileContentType() {
		return fileContentType;
	}



	public void setFileContentType(String fileContentType) {
		this.fileContentType = fileContentType;
	}



	/**
	 * ㄤ瀹颁浼
	 */
//	@Override
//	public String execute() throws Exception {
//		// TODO Auto-generated method stub
//		//瀹颁浼
//		InputStream is = new FileInputStream(file);
//		String root = ServletActionContext.getRequest().getRealPath("/upload");
//		System.out.println(this.getFileContentType() );
//		File deskFile = new File(root,this.getFileFileName());
//		System.out.println(this.getFileFileName() );
//		OutputStream os = new FileOutputStream(deskFile);
//		byte [] bytefer = new byte[400];
//		int length = 0 ; 
//		while((length = is.read(bytefer) )>0)
//		{
//			os.write(bytefer,0,length);
//		}
//		os.close();
//		is.close();
//		return SUCCESS;
//	}
	 
	private File[] upload;
    private String[] uploadFileName;
    private String[] uploadContentType;
    
    /**
	 * @return the upload
	 */
	public File[] getUpload() {
		return upload;
	}
	/**
	 * @param upload the upload to set
	 */
	public void setUpload(File[] upload) {
		this.upload = upload;
	}
	/**
	 * @return the uploadFileName
	 */
	public String[] getUploadFileName() {
		return uploadFileName;
	}
	/**
	 * @param uploadFileName the uploadFileName to set
	 */
	public void setUploadFileName(String[] uploadFileName) {
		this.uploadFileName = uploadFileName;
	}
	/**
	 * @return the uploadContentType
	 */
	public String[] getUploadContentType() {
		return uploadContentType;
	}
	/**
	 * @param uploadContentType the uploadContentType to set
	 */
	public void setUploadContentType(String[] uploadContentType) {
		this.uploadContentType = uploadContentType;
	}
	
	/**
	 * 默认上传
	 * @return
	 */
	public String execute() {
		String pageErrorInfo = null;

		//这里添加和删除都要从smartupload中获得参数
		try {			
			ServletActionContext.getRequest().setCharacterEncoding("UTF-8");
	        String filepath = ServletActionContext.getServletContext().getRealPath("/softwares");
	        System.out.println(filepath);
			
	        insert(filepath);
		
		} catch (Exception e){
			e.printStackTrace();
			pageErrorInfo = e.getMessage();
		}
	
		return SUCCESS;
	}

	/**
	 * 增加软件
	 * @param request
	 * @param response
	 * @throws ServletException
	 * @throws IOException
	 */
	public boolean insert(String path)
			throws ServletException, IOException, Exception{
		
		if (upload.length == 0) throw new Exception("请选择上传的文件");
		
		// 写到指定路径
		File file = new File(path);
		//判断指定的路径下是否有softwares，如果没有，自动创建
		if (!file.exists()) {
			file.mkdirs();
		}
		
		for(int i=0;i<upload.length;i++){
            String fileName = uploadFileName[i];
			
			//存入本地
			try{
				FileUtils.copyFile(upload[i], new File(file, fileName));
			
			}catch (Exception e){
			
				throw new Exception("中文转码失败，请上传时修改文件名");
			}
			
		}
		
		return true;
	}
}
